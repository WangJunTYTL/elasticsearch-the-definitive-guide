
水平扩展
==============

* [一个空集群](an-empty-cluster.md)
* [集群健康](cluster-helth.md)
* [添加索引](add-an-index.md)
* [故障转移](add-failover.md)
* [水平扩展](scale-horizontally.md)
* [应对失败](coping-with-failure)

随着我们应用的需求增长，如何进行扩展呢？如果我们启动第3个节点，我们的集群将重组自己，看起来就像图4，“三节点集群——分片被重新分配平摊负载”。

![三节点集群](elas_0204.png)

图4. 三节点集群——分片被重新分配平摊负载

节点1和节点2分别有一个分片被移往节点3，从3个分片变成2个。这意味这每个节点的硬件资源（CPU、RAM、I/O）支撑更少的分片，每个分片能运行得更好。

一个分片本身是一个完整的搜索引擎，它能利用到所在节点的所有资源。通过我们的6个分片（3个主分片和3个复制分片），索引最多能扩展到6个节点，即每个节点分布一个分片，每个分片能使用所在节点的全部资源。

接下来继续扩展
------------

假如我们想扩展到多余6个节点，该怎么办呢？

当索引创建时主分片的数量就被确定了。实际上，数据最大容量的数字是能被存储在索引的（真实的数字决定于数据、硬件和使用情况）。然而，读请求（搜索或检索文档）能被主分片或复制分片处理，因此数据拷贝越多，搜索的吞吐量就越大。

对于一个运行着的集群而言，复制分片的数量是可以被动态修改的，这就允许我们随着需求增加或者减少分片的数量。现在让我们将复制分片的数量从默认的1调整为2：

```shell
PUT /blogs/_settings
{
    "number_of_replicas" : 2
}
```

就像我们在图5中所见，“复制分片数量增长到2”，`blogs`索引现在有9个分片了：3个主分片和6个复制分片。这意味着我们能扩展到9个节点，每个节点1个分片。这能让我们提供比原始的3节点集群好3倍的性能。

![2个复制分片的3节点集群](elas_0205.png)

图5. 复制分片数量增长到2


> 提示
> --------------
> 当然，在节点数量一定的前提下，仅仅靠增加复制分片数量，并不能改善我们的性能，因为每个分片被分配到更少比例的节点资源。你必须通过增加硬件来提升吞吐量。

> 另一方面，这些额外的复制分片意味这我们拥有更多的冗余，按照上面的配置，可以允许挂掉两个节点而不丢失数据。


---------------------------


[« 故障转移](add-failover.md)    [应对失败 »](coping-with-failure)
