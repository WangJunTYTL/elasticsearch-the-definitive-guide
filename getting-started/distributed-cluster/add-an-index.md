
添加索引
============

* [一个空集群](an-empty-cluster.md)
* [集群健康](cluster-health.md)
* [添加索引](add-an-index.md)
* [故障转移](add-failover.md)
* [水平扩展](scale-horizontally.md)
* [应对失败](coping-with-failure)


要添加数据到Elasticsearch，我们需要添加一个索引关联数据。实际上，一个索引仅仅是一个命名空间，它指向一个或多个物理分片。

一个分片是一个低级别的工作单元，拥有全部索引的部分数据。在《[分片详解](inside-shard.md)》一章，我们将详细解释一个分片如何工作，不过现在知道分片是一个Lucene的实例，本身就是一个完整的搜索引擎，就够了。我们的文档在分片内被存储和索引，不过应用并不会直接访问到文档，而是先访问索引。

如果认为分片是数据的容器，那么分片就是Elasticsearch在集群内分布的数据。文档存储在分片内，分片被分配在集群的节点内。随着集群的增长或者收缩，Elasticsearch将自动迁移节点里的分片，维持集群内的平衡。

一个分片可以是主分片或者复制分片，索引里的文档属于一个单独的朱分片，所以主分片的数量决定了索引拥有的最大数据容量。

> **注意**
> ---------	
> 理论上不存在主分片的数据容量上限，但还是有一个实际的限制。决定最大分片数据容量的因素取决于你的实际情况：硬件、文档大小和复杂程度、如何索引和查询文档、以及你期望的响应时间。

一个复制分片仅仅是主分片的拷贝，复制分片用来提供数据冗余和预防硬件故障，以及相应索或检索文档的请求。

主分片的数量在索引被创建的时候已经决定了，但是复制分片的数量可以在任何时候修改。

下面让我们在你的单节点空集群里边创建一个叫`blogs`的索引。索引默认被分配5个主分片，不过为了便于演示，我们只分配3个主分片，以及一个复制分片（每个主分片对应一个分片）：

```shell
PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}
```

我们的集群现在就像图2，“有一个索引的单节点集群”。三个主分片都被分配到了Node 1。

![有一个索引的单节点集群](elas_0202.png)

图2.有一个索引的单节点集群


如果我们现在检查集群的健康，我们可以看到下述内容：

```json
{
   "cluster_name":          "elasticsearch",
   "status":                "yellow", 
   "timed_out":             false,
   "number_of_nodes":       1,
   "number_of_data_nodes":  1,
   "active_primary_shards": 3,
   "active_shards":         3,
   "relocating_shards":     0,
   "initializing_shards":   0,
   "unassigned_shards":     3 
}
```

1. 集群的状态是黄色的。
2. 三个复制分片还没有被分配到任何节点。


集群健康为黄色，表明所有主分片已经启动正常运转（集群已经能成功响应任何请求），但是不是所有复制分片都正常。实际上，三个复制分片都还没有分配到任何节点。将数据复制到同一个节点没有意义，如果这个节点挂掉，我们依然失去所有数据。

现在，我们的集群功能齐全，但万一有硬件故障的话，数据还将继续面临丢失的风险。


------------------------------------------


[« 集群健康](cluster-health.md)   [添加故障转移 »](add-failover.md)

